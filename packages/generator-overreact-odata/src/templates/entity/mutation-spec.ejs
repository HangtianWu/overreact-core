import _ from 'underscore';
import queryString from 'query-string';
import {
  createRequestContract,
  createResponseContract,
  requestVerbs,
  responseTypes,
  FetchPolicy,
} from '@microsoft/overreact';

import { edm } from '<%= edmLocation %>';
import { envLookupFn } from '<%= envLocation %>';

function odataUrlFactory(params) {
  const { variables } = params;
  const { locator, cursorIndex } = variables;
  const { descriptor } = locator;
  const { <%- descriptorList %> } = descriptor;

  const path =
    <%- odataUri %>;
  return path;
}

function odataHeaderFactory(params) {
  const { headers } = params;
  return headers;
}

function odataPayloadFactory(params) {
  const { data } = params;
  return JSON.stringify(data);
}

export const requestContract = createRequestContract({
  schema,
  dataPath: '<%= dataPath %>',
  verb: requestVerbs.PATCH,
  fetchPolicy: FetchPolicy.NetworkOrStore,
  uriFactoryFn: odataUrlFactory,
  headerFactoryFn: odataHeaderFactory,
	payloadFactoryFn: odataPayloadFactory,
});

export const responseContract = createResponseContract({
  requestContract,
  responseType: responseTypes.ENTITY,
  keySelector: r => r.<%= key %>,
  processorFn: r => r,
});

export const spec = createSpec(
  requestContract,
  responseContract,
  specTypes.MUTATION,
  null,
  envLookupFn,
);
